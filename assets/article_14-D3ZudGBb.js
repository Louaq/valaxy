import{_ as o}from"./ValaxyMain.vue_vue_type_style_index_0_lang-C5JMZwJJ.js";import{c as g,w as l,f as m,e as c,p as k,o as y,g as i,h as s,r as t}from"./app-CftBLVN4.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-BnQoO184.js";import"./YunCard.vue_vue_type_script_setup_true_lang-BpvS834H.js";import"./index-C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-B2zv5Aao.js";import"./post-DkFQf5pI.js";const D={__name:"article_14",setup(E,{expose:p}){const e=JSON.parse('{"title":"报错","description":"","frontmatter":{"title":"报错","date":"2024-08-1 12:00:00","expires":"2024-08-21 13:00:00","thumbnail":"https://yangyang666.oss-cn-chengdu.aliyuncs.com/images/30_Abyss_4k_e2e25.jpg","tags":["论文","python"],"categories":["YOLO"]},"headers":[{"level":2,"title":"一、本文介绍","slug":"一、本文介绍","link":"#一、本文介绍","children":[]},{"level":2,"title":"二、 报错问题","slug":"二、-报错问题","link":"#二、-报错问题","children":[{"level":3,"title":"(1)训练过程中loss出现Nan值.","slug":"_1-训练过程中loss出现nan值","link":"#_1-训练过程中loss出现nan值","children":[]},{"level":3,"title":"(2)多卡训练问题,修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作，两个是不同的操作，是代表不同的版本现尝试第一个不行用第二个","slug":"_2-多卡训练问题-修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作-两个是不同的操作-是代表不同的版本现尝试第一个不行用第二个","link":"#_2-多卡训练问题-修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作-两个是不同的操作-是代表不同的版本现尝试第一个不行用第二个","children":[]},{"level":3,"title":"(3) 针对运行过程中的一些报错解决","slug":"_3-针对运行过程中的一些报错解决","link":"#_3-针对运行过程中的一些报错解决","children":[]},{"level":3,"title":"(4) 针对yaml文件中的nc修改","slug":"_4-针对yaml文件中的nc修改","link":"#_4-针对yaml文件中的nc修改","children":[]},{"level":3,"title":"(5) 针对环境的问题","slug":"_5-针对环境的问题","link":"#_5-针对环境的问题","children":[]},{"level":3,"title":"(6) 训练过程中不打印GFLOpS","slug":"_6-训练过程中不打印gflops","link":"#_6-训练过程中不打印gflops","children":[]},{"level":3,"title":"(7) mmcv安装的解决方法","slug":"_7-mmcv安装的解决方法","link":"#_7-mmcv安装的解决方法","children":[]}]}],"relativePath":"pages/posts/article_14.md","path":"/home/runner/work/valaxy/valaxy/pages/posts/article_14.md","lastUpdated":1728120338000}'),h=c(),n=e.frontmatter||{};return h.meta.frontmatter=Object.assign(h.meta.frontmatter||{},e.frontmatter||{}),k("pageData",e),k("valaxy:frontmatter",n),globalThis.$frontmatter=n,p({frontmatter:{title:"报错",date:"2024-08-1 12:00:00",expires:"2024-08-21 13:00:00",thumbnail:"https://yangyang666.oss-cn-chengdu.aliyuncs.com/images/30_Abyss_4k_e2e25.jpg",tags:["论文","python"],categories:["YOLO"]}}),(a,r)=>{const d=o;return y(),g(d,{frontmatter:m(n)},{"main-content-md":l(()=>r[0]||(r[0]=[i("h2",{id:"一、本文介绍",tabindex:"-1"},[s("一、本文介绍 "),i("a",{class:"header-anchor",href:"#一、本文介绍","aria-label":'Permalink to "一、本文介绍"'},"​")],-1),i("p",null,[s("本文为专栏内读者和我个人在训练"),i("strong",null,"YOLOv8时遇到的各种错误解决方案"),s("，你遇到的问题本文基本上都能够解决。")],-1),i("h2",{id:"二、-报错问题",tabindex:"-1"},[s("二、 报错问题 "),i("a",{class:"header-anchor",href:"#二、-报错问题","aria-label":'Permalink to "二、 报错问题"'},"​")],-1),i("p",null,"# 以下为两个重要库的版本，大家可以对应下载，使用教程我会更新，时间还没来得及大家可以先看视频使用。",-1),i("blockquote",null,[i("p",null,[i("strong",null,"项目环境：")]),i("p",null,"python == 3.9.7"),i("p",null,"pytorch == 1.12.1"),i("p",null,"timm == 0.9.12"),i("p",null,"mmcv-full == 1.6.2")],-1),i("hr",null,null,-1),i("h3",{id:"_1-训练过程中loss出现nan值",tabindex:"-1"},[s("(1)训练过程中loss出现Nan值. "),i("a",{class:"header-anchor",href:"#_1-训练过程中loss出现nan值","aria-label":'Permalink to "(1)训练过程中loss出现Nan值."'},"​")],-1),i("p",null,"可以尝试关闭AMP混合精度训练，如何关闭amp呢找到如下文件’ultralytics/cfg/default.yaml’，其中有一个参数是",-1),i("p",null,"amp: False # (bool) Automatic Mixed Precision (AMP) training, choices=[True, False], True runs AMP check",-1),i("p",null,"我们将其设置为False即可，默认时为True。",-1),i("p",null,".",-1),i("h3",{id:"_2-多卡训练问题-修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作-两个是不同的操作-是代表不同的版本现尝试第一个不行用第二个",tabindex:"-1"},[s("(2)多卡训练问题,修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作，两个是不同的操作，是代表不同的版本现尝试第一个不行用第二个 "),i("a",{class:"header-anchor",href:"#_2-多卡训练问题-修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作-两个是不同的操作-是代表不同的版本现尝试第一个不行用第二个","aria-label":'Permalink to "(2)多卡训练问题,修改模型以后不能支持多卡训练可以尝试下面的两行命令行操作，两个是不同的操作，是代表不同的版本现尝试第一个不行用第二个"'},"​")],-1),i("p",null,"python -m torch.distributed.run --nproc_per_node 2 train.py",-1),i("p",null,"python -m torch.distributed.launch --nproc_per_node 2 train.py",-1),i("hr",null,null,-1),i("h3",{id:"_3-针对运行过程中的一些报错解决",tabindex:"-1"},[s("(3) 针对运行过程中的一些报错解决 "),i("a",{class:"header-anchor",href:"#_3-针对运行过程中的一些报错解决","aria-label":'Permalink to "(3) 针对运行过程中的一些报错解决"'},"​")],-1),i("p",null,[i("strong",null,"1.如果训练的过程中验证报错了(主要是一些形状不匹配的错误这是因为验证集的一些特殊图片导致)")],-1),i("p",null,"就是有这种训练第一个epochs完成后开始验证的时候报错，下面的方法基本百分之九十都能够解决。",-1),i("figure",null,[i("img",{src:"https://yangyang666.oss-cn-chengdu.aliyuncs.com/typoraImages/e61c95278a244aebbe4ac67f07f90466.png",alt:"",loading:"lazy",decoding:"async"})],-1),i("p",null,"找到ultralytics/models/yolo/detect/train.py的DetectionTrainer class中的build_dataset函数中的rect=mode == 'val’改为rect=False",-1),i("p",null,[i("strong",null,"2.推理的时候运行detect.py文件报了形状不匹配的错误")],-1),i("p",null,"找到ultralytics/engine/predictor.py找到函数def pre_transform(self, im),在LetterBox中的auto改为False",-1),i("p",null,[i("strong",null,"3.训练的过程中报错类型不匹配的问题")],-1),i("p",null,"找到’ultralytics/engine/validator.py’文件找到 'class BaseValidator:' 然后在其’__call__'中",-1),i("p",null,"self.args.half = self.device.type != 'cpu'  # force FP16 val during training的一行代码下面加上self.args.half = False",-1),i("hr",null,null,-1),i("h3",{id:"_4-针对yaml文件中的nc修改",tabindex:"-1"},[s("(4) 针对yaml文件中的nc修改 "),i("a",{class:"header-anchor",href:"#_4-针对yaml文件中的nc修改","aria-label":'Permalink to "(4) 针对yaml文件中的nc修改"'},"​")],-1),i("p",null,"不用修改，模型会自动根据你数据集的配置文件获取。",-1),i("p",null,"这也是模型打印两次的区别，第一次打印出来的就是你选择模型的yaml文件结构，第二次打印的就是替换了你数据集的yaml文件，模型使用的是第二种。",-1),i("hr",null,null,-1),i("h3",{id:"_5-针对环境的问题",tabindex:"-1"},[s("(5) 针对环境的问题 "),i("a",{class:"header-anchor",href:"#_5-针对环境的问题","aria-label":'Permalink to "(5) 针对环境的问题"'},"​")],-1),i("p",null,"环境的问题我实在解决不过来，所以大家可以自行在网上搜索解决方案。",-1),i("hr",null,null,-1),i("h3",{id:"_6-训练过程中不打印gflops",tabindex:"-1"},[s("(6) 训练过程中不打印GFLOpS "),i("a",{class:"header-anchor",href:"#_6-训练过程中不打印gflops","aria-label":'Permalink to "(6) 训练过程中不打印GFLOpS"'},"​")],-1),i("p",null,"计算的GFLOPs计算异常不打印，所以需要额外修改一处， 我们找到如下文件’ultralytics/utils/torch_utils.py’文件内有如下的代码按照如下的图片进行修改，大家看好函数就行，其中红框的640可能和你的不一样， 然后用我给的代码替换掉整个代码即可。",-1),i("figure",null,[i("img",{src:"https://yangyang666.oss-cn-chengdu.aliyuncs.com/typoraImages/24068f6039b94ceeb91e98642c00e594.png",alt:"",loading:"lazy",decoding:"async"})],-1),i("div",{class:"language-python vp-adaptive-theme"},[i("button",{title:"Copy Code",class:"copy"}),i("span",{class:"lang"},"python"),i("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[i("code",{"v-pre":""},[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"def"),i("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," get_flops"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(model, imgsz"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"640"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"):")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},`    """Return a YOLO model's FLOPs."""`)]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        model "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," de_parallel(model)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        p "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," next"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(model.parameters())")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        # stride = max(int(model.stride.max()), 32) if hasattr(model, 'stride') else 32  # max stride")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        stride "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 640")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        im "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," torch.empty(("),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"3"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", stride, stride), "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"device"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"p.device)  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# input image in BCHW format")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        flops "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," thop.profile(deepcopy(model), "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"inputs"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[im], "),i("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"verbose"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"False"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1E9"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," *"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," thop "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0"),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  # stride GFLOPs")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        imgsz "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," imgsz "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," isinstance"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(imgsz, "),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"list"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," [imgsz, imgsz]  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# expand if int/float")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," flops "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," imgsz["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," stride "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"*"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," imgsz["),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"] "),i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"/"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," stride  "),i("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 640x640 GFLOPs")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    except"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," Exception"),i("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),i("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0")])])]),i("button",{class:"collapse"})],-1),i("hr",null,null,-1),i("h3",{id:"_7-mmcv安装的解决方法",tabindex:"-1"},[s("(7) mmcv安装的解决方法 "),i("a",{class:"header-anchor",href:"#_7-mmcv安装的解决方法","aria-label":'Permalink to "(7) mmcv安装的解决方法"'},"​")],-1),i("p",null,[s("有的读者mmcv-full会安装失败是因为自身系统的编译工具有问题，也有可能是环境之间安装的有冲突 推荐大家离线安装的形式,下面的地址中大家可以找找自己的版本,下载到本地进行安装。 "),i("a",{href:"https://download.openmmlab.com/mmcv/dist/cu111/torch1.8.0/index.html",target:"_blank",rel:"noreferrer"},"https://download.openmmlab.com/mmcv/dist/cu111/torch1.8.0/index.html"),s(),i("a",{href:"https://download.openmmlab.com/mmcv/dist/index.html",target:"_blank",rel:"noreferrer"},"https://download.openmmlab.com/mmcv/dist/index.html")],-1)])),"main-header":l(()=>[t(a.$slots,"main-header")]),"main-header-after":l(()=>[t(a.$slots,"main-header-after")]),"main-nav":l(()=>[t(a.$slots,"main-nav")]),"main-content":l(()=>[t(a.$slots,"main-content")]),"main-content-after":l(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[t(a.$slots,"main-nav-after")]),comment:l(()=>[t(a.$slots,"comment")]),footer:l(()=>[t(a.$slots,"footer")]),aside:l(()=>[t(a.$slots,"aside")]),"aside-custom":l(()=>[t(a.$slots,"aside-custom")]),default:l(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{D as default};
